<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Debug Tool</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        h1 { color: #0f0; border-bottom: 2px solid #0f0; padding-bottom: 10px; }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        button:hover { background: #0a0; }
        .section {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #0f0;
        }
        .label { color: #0af; font-weight: bold; }
        .value { color: #fff; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .warning { color: #fa0; }
        pre {
            background: #000;
            padding: 10px;
            overflow-x: auto;
            border: 1px solid #0f0;
        }
        .coords { font-size: 18px; font-weight: bold; color: #0af; }
        input {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px;
            font-family: 'Courier New', monospace;
            width: 150px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <h1>üåç Location Service Debugger</h1>
    
    <div class="section">
        <h2>Current Browser Location</h2>
        <button onclick="getLocation()">üìç Get My Location</button>
        <button onclick="clearResults()">üóëÔ∏è Clear</button>
        <div id="result"></div>
    </div>

    <div class="section">
        <h2>Test Specific Coordinates</h2>
        <label class="label">Latitude:</label>
        <input type="number" id="testLat" step="0.0001" placeholder="e.g., 19.0760" />
        <label class="label">Longitude:</label>
        <input type="number" id="testLon" step="0.0001" placeholder="e.g., 72.8777" />
        <button onclick="testCoords()">üîç Reverse Geocode</button>
        <div id="testResult"></div>
    </div>

    <div class="section">
        <h2>Known City Coordinates (for testing)</h2>
        <button onclick="testCity(19.0760, 72.8777, 'Mumbai')">Mumbai</button>
        <button onclick="testCity(28.6139, 77.2090, 'Delhi')">Delhi</button>
        <button onclick="testCity(18.5204, 73.8567, 'Pune')">Pune</button>
        <button onclick="testCity(22.5726, 88.3639, 'Kolkata')">Kolkata</button>
        <button onclick="testCity(13.0827, 80.2707, 'Chennai')">Chennai</button>
        <button onclick="testCity(12.9716, 77.5946, 'Bangalore')">Bangalore</button>
    </div>

    <div class="section">
        <h2>Console Logs</h2>
        <pre id="logs"></pre>
    </div>

    <script>
        const logsDiv = document.getElementById('logs');
        
        // Capture console logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addLog(type, ...args) {
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
            logsDiv.textContent += `[${type}] ${msg}\n`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = (...args) => { originalLog(...args); addLog('LOG', ...args); };
        console.warn = (...args) => { originalWarn(...args); addLog('WARN', ...args); };
        console.error = (...args) => { originalError(...args); addLog('ERROR', ...args); };

        function clearResults() {
            document.getElementById('result').innerHTML = '';
            document.getElementById('testResult').innerHTML = '';
            logsDiv.textContent = '';
        }

        async function reverseGeocode(lat, lon) {
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;
            console.log('Fetching:', url);
            
            const response = await fetch(url, {
                headers: { 'User-Agent': 'BeanJamBot-ChatApp' }
            });
            
            const data = await response.json();
            console.log('OpenStreetMap response:', data);
            
            return data;
        }

        async function getLocation() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p class="warning">‚è≥ Requesting location permission...</p>';
            
            if (!navigator.geolocation) {
                resultDiv.innerHTML = '<p class="error">‚ùå Geolocation not supported</p>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const acc = position.coords.accuracy;
                    
                    console.log('GPS Coordinates:', { lat, lon, accuracy: acc });
                    
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ GPS Permission Granted</p>
                        <p class="coords">üìç ${lat.toFixed(6)}, ${lon.toFixed(6)}</p>
                        <p class="label">Accuracy: <span class="value">${acc.toFixed(0)} meters</span></p>
                        <p class="warning">‚è≥ Reverse geocoding...</p>
                    `;

                    try {
                        const data = await reverseGeocode(lat, lon);
                        const address = data.address || {};
                        
                        const city = address.city || address.town || address.village || 
                                   address.hamlet || address.municipality || address.county || 
                                   address.state_district;
                        
                        resultDiv.innerHTML = `
                            <p class="success">‚úÖ GPS Permission Granted</p>
                            <p class="coords">üìç ${lat.toFixed(6)}, ${lon.toFixed(6)}</p>
                            <p class="label">Accuracy: <span class="value">${acc.toFixed(0)} meters</span></p>
                            <hr style="border-color: #0f0;">
                            <p class="label">Detected City: <span class="success">${city || 'NOT FOUND'}</span></p>
                            <p class="label">Region/State: <span class="value">${address.state || address.province || 'N/A'}</span></p>
                            <p class="label">Country: <span class="value">${address.country || 'N/A'}</span></p>
                            <hr style="border-color: #0f0;">
                            <p class="label">Full Address Object:</p>
                            <pre>${JSON.stringify(address, null, 2)}</pre>
                            <p class="label">Display Name:</p>
                            <p class="value">${data.display_name || 'N/A'}</p>
                        `;
                        
                        if (!city) {
                            resultDiv.innerHTML += `
                                <p class="warning">‚ö†Ô∏è No city detected! Available address fields:</p>
                                <p class="value">${Object.keys(address).join(', ')}</p>
                            `;
                        }
                    } catch (error) {
                        resultDiv.innerHTML += `<p class="error">‚ùå Reverse geocoding failed: ${error.message}</p>`;
                    }
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    resultDiv.innerHTML = `
                        <p class="error">‚ùå Location Error (Code ${error.code})</p>
                        <p class="value">${error.message}</p>
                        <p class="warning">Try allowing location permission in browser settings</p>
                    `;
                },
                { 
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0 
                }
            );
        }

        async function testCoords() {
            const lat = parseFloat(document.getElementById('testLat').value);
            const lon = parseFloat(document.getElementById('testLon').value);
            const resultDiv = document.getElementById('testResult');
            
            if (isNaN(lat) || isNaN(lon)) {
                resultDiv.innerHTML = '<p class="error">‚ùå Please enter valid coordinates</p>';
                return;
            }

            resultDiv.innerHTML = '<p class="warning">‚è≥ Reverse geocoding...</p>';

            try {
                const data = await reverseGeocode(lat, lon);
                const address = data.address || {};
                
                const city = address.city || address.town || address.village || 
                           address.hamlet || address.municipality || address.county || 
                           address.state_district;
                
                resultDiv.innerHTML = `
                    <p class="coords">üìç ${lat.toFixed(6)}, ${lon.toFixed(6)}</p>
                    <p class="label">Detected City: <span class="success">${city || 'NOT FOUND'}</span></p>
                    <p class="label">Region/State: <span class="value">${address.state || address.province || 'N/A'}</span></p>
                    <p class="label">Country: <span class="value">${address.country || 'N/A'}</span></p>
                    <hr style="border-color: #0f0;">
                    <p class="label">Full Address Object:</p>
                    <pre>${JSON.stringify(address, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function testCity(lat, lon, name) {
            document.getElementById('testLat').value = lat;
            document.getElementById('testLon').value = lon;
            await testCoords();
        }
    </script>
</body>
</html>
